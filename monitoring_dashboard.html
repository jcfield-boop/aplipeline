<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLCICD - Enterprise Monitoring & Management Console</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'JetBrains Mono', 'Fira Code', monospace; 
            background: #0d1117; 
            color: #c9d1d9; 
            line-height: 1.6;
        }
        .container { 
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 1px;
            background: #21262d;
        }
        
        /* Header */
        .header { 
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #1f6feb, #7c3aed);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 1.5em; }
        .header .status { 
            display: flex; 
            gap: 15px; 
            align-items: center;
        }
        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-live { background: #3fb950; color: #000; }
        .status-alert { background: #f85149; color: #fff; }
        .status-warning { background: #ffa657; color: #000; }
        
        /* Sidebar */
        .sidebar {
            background: #161b22;
            padding: 20px;
            overflow-y: auto;
        }
        .sidebar h3 {
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
        }
        .config-section {
            margin-bottom: 25px;
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .config-item {
            margin-bottom: 15px;
        }
        .config-item label {
            display: block;
            color: #ffa657;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .config-item input, .config-item select {
            width: 100%;
            padding: 6px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #c9d1d9;
            font-family: inherit;
            font-size: 12px;
        }
        .config-item input[type="range"] {
            padding: 0;
        }
        .config-value {
            color: #79c0ff;
            font-size: 11px;
            margin-top: 2px;
        }
        .save-config {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            width: 100%;
        }
        .save-config:hover { background: #2ea043; }
        
        /* Main Content */
        .main-content {
            background: #0d1117;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: #161b22;
            border-bottom: 1px solid #30363d;
        }
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab:hover { background: #21262d; }
        .tab.active { 
            background: #0d1117; 
            border-bottom-color: #58a6ff;
            color: #58a6ff;
        }
        
        /* Content Panels */
        .panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }
        .panel.active { display: block; }
        
        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .metric-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #79c0ff;
            margin-bottom: 5px;
        }
        .metric-label {
            color: #8b949e;
            font-size: 12px;
        }
        .metric-trend {
            margin-top: 8px;
            font-size: 11px;
        }
        .trend-up { color: #3fb950; }
        .trend-down { color: #f85149; }
        
        /* Log Stream */
        .log-container {
            background: #010409;
            border: 1px solid #21262d;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            padding: 15px;
        }
        .log-entry {
            margin-bottom: 2px;
            white-space: pre-wrap;
        }
        .log-timestamp { color: #8b949e; }
        .log-level-info { color: #79c0ff; }
        .log-level-warn { color: #ffa657; }
        .log-level-error { color: #f85149; }
        .log-level-success { color: #3fb950; }
        
        /* Triage Queue */
        .triage-item {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .triage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .triage-id { color: #58a6ff; font-weight: bold; }
        .triage-priority {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        .priority-high { background: #f85149; color: white; }
        .priority-medium { background: #ffa657; color: black; }
        .priority-low { background: #3fb950; color: black; }
        .triage-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .triage-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-family: inherit;
        }
        .btn-approve { background: #238636; color: white; }
        .btn-reject { background: #da3633; color: white; }
        .btn-escalate { background: #6f42c1; color: white; }
        
        /* Performance Chart */
        .chart-container {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-title {
            color: #58a6ff;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        /* Alerts */
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }
        .alert-error { 
            background: rgba(248, 81, 73, 0.1); 
            border-left-color: #f85149; 
        }
        .alert-warning { 
            background: rgba(255, 166, 87, 0.1); 
            border-left-color: #ffa657; 
        }
        .alert-info { 
            background: rgba(121, 192, 255, 0.1); 
            border-left-color: #79c0ff; 
        }
        
        /* APL Output Styling */
        .apl-function { color: #ff7b72; font-weight: bold; }
        .apl-number { color: #79c0ff; }
        .apl-comment { color: #8b949e; }
        .highlight-result { color: #3fb950; font-weight: bold; }
        .highlight-priority { color: #f85149; font-weight: bold; }
        .highlight-score { color: #ffa657; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>APLCICD Enterprise Console</h1>
            <div class="status">
                <div class="status-indicator status-live">‚óè LIVE</div>
                <div class="status-indicator" id="throughput">0 PR/min</div>
                <div class="status-indicator" id="queue-size">Queue: 0</div>
            </div>
        </div>
        
        <!-- Sidebar Configuration -->
        <div class="sidebar">
            <h3>‚öôÔ∏è Configuration</h3>
            
            <div class="config-section">
                <h4 style="color: #f85149; margin-bottom: 10px;">üîê Repository Secrets</h4>
                
                <div class="config-item">
                    <label>Git Provider</label>
                    <select id="gitProvider" onchange="updateConfig()">
                        <option value="github">GitHub</option>
                        <option value="gitlab">GitLab</option>
                        <option value="bitbucket">Bitbucket</option>
                        <option value="azure">Azure DevOps</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label>Repository URL</label>
                    <input type="text" id="repoUrl" placeholder="https://github.com/user/repo.git" onchange="updateConfig()">
                </div>
                
                <div class="config-item">
                    <label>Access Token</label>
                    <input type="password" id="accessToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" onchange="updateConfig()">
                    <div class="config-value">GitHub: Settings ‚Üí Developer settings ‚Üí Personal access tokens</div>
                </div>
                
                <div class="config-item">
                    <label>Webhook Secret (Optional)</label>
                    <input type="password" id="webhookSecret" placeholder="webhook_secret_key" onchange="updateConfig()">
                </div>
                
                <div class="config-item">
                    <label>SSH Private Key (Optional)</label>
                    <textarea id="sshKey" rows="3" placeholder="-----BEGIN OPENSSH PRIVATE KEY-----" 
                              style="width: 100%; background: #21262d; border: 1px solid #30363d; color: #c9d1d9; font-family: inherit; font-size: 11px; padding: 6px; border-radius: 4px;" 
                              onchange="updateConfig()"></textarea>
                </div>
                
                <button class="save-config" onclick="testConnection()" style="background: #6f42c1; margin-bottom: 10px;">üîó Test Connection</button>
            </div>
            
            <div class="config-section">
                <h4 style="color: #58a6ff; margin-bottom: 10px;">üìä Grafana Integration</h4>
                
                <div class="config-item">
                    <label>Grafana Cloud URL</label>
                    <input type="text" id="grafanaUrl" value="https://aplipeline.grafana.net" onchange="updateConfig()">
                </div>
                
                <div class="config-item">
                    <label>Grafana API Key</label>
                    <input type="password" id="grafanaApiKey" placeholder="glsa_xxxxxxxxxxxxxxxxxxxx" onchange="updateConfig()">
                    <div class="config-value">Administration ‚Üí API Keys ‚Üí Add API Key</div>
                </div>
                
                <div class="config-item">
                    <label>Organization ID</label>
                    <input type="number" id="grafanaOrgId" value="1" onchange="updateConfig()">
                </div>
                
                <div class="config-item">
                    <label>Dashboard Refresh</label>
                    <select id="dashboardRefresh" onchange="updateConfig()">
                        <option value="5s">5 seconds</option>
                        <option value="10s" selected>10 seconds</option>
                        <option value="30s">30 seconds</option>
                        <option value="1m">1 minute</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label>Enable Alerts</label>
                    <select id="grafanaAlerts" onchange="updateConfig()">
                        <option value="true" selected>Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                
                <button class="save-config" onclick="setupGrafana()" style="background: #ff8c00; margin-bottom: 10px;">üìä Setup Grafana</button>
                <button class="save-config" onclick="deployDashboard()" style="background: #1f6feb; margin-bottom: 10px;">üöÄ Deploy Dashboard</button>
            </div>

            <div class="config-section">
                <h4 style="color: #ffa657; margin-bottom: 10px;">Pipeline Settings</h4>
                
                <div class="config-item">
                    <label>Quality Threshold</label>
                    <input type="range" id="qualityThreshold" min="0" max="1" step="0.01" value="0.50" oninput="updateConfig()">
                    <div class="config-value" id="qualityValue">0.50</div>
                </div>
                
                <div class="config-item">
                    <label>AI Detection Threshold</label>
                    <input type="range" id="aiThreshold" min="0" max="1" step="0.01" value="0.30" oninput="updateConfig()">
                    <div class="config-value" id="aiValue">0.30</div>
                </div>
                
                <div class="config-item">
                    <label>Security Mode</label>
                    <select id="securityMode" onchange="updateConfig()">
                        <option value="strict">Strict</option>
                        <option value="standard">Standard</option>
                        <option value="permissive">Permissive</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label>Auto-reject AI PRs</label>
                    <select id="autoRejectAI" onchange="updateConfig()">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                        <option value="triage">Send to Triage</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label>Parallel Workers</label>
                    <input type="range" id="parallelWorkers" min="1" max="32" value="8" oninput="updateConfig()">
                    <div class="config-value" id="workersValue">8</div>
                </div>
                
                <div class="config-item">
                    <label>Batch Size</label>
                    <input type="range" id="batchSize" min="10" max="1000" value="100" oninput="updateConfig()">
                    <div class="config-value" id="batchValue">100 PRs</div>
                </div>
            </div>
            
            <div class="config-section">
                <h4 style="color: #ffa657; margin-bottom: 10px;">Performance</h4>
                
                <div class="config-item">
                    <label>Cache TTL (minutes)</label>
                    <input type="number" id="cacheTTL" value="60" min="1" max="1440" onchange="updateConfig()">
                </div>
                
                <div class="config-item">
                    <label>Memory Limit (GB)</label>
                    <input type="range" id="memoryLimit" min="1" max="64" value="8" oninput="updateConfig()">
                    <div class="config-value" id="memoryValue">8 GB</div>
                </div>
                
                <div class="config-item">
                    <label>Enable Profiling</label>
                    <select id="enableProfiling" onchange="updateConfig()">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
            </div>
            
            <button class="save-config" onclick="saveConfiguration()">üíæ Save Configuration</button>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="showPanel('overview')">üìä Overview</div>
                <div class="tab" onclick="showPanel('logs')">üìú Logs</div>
                <div class="tab" onclick="showPanel('triage')">‚öñÔ∏è Triage Queue</div>
                <div class="tab" onclick="showPanel('performance')">‚ö° Performance</div>
                <div class="tab" onclick="showPanel('alerts')">üö® Alerts</div>
            </div>
            
            <!-- Overview Panel -->
            <div class="panel active" id="overview-panel">
                <h2 style="margin-bottom: 20px; color: #58a6ff;">System Overview</h2>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="totalPRs">1,247</div>
                        <div class="metric-label">PRs Processed Today</div>
                        <div class="metric-trend trend-up">‚Üó +15% vs yesterday</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgThroughput">42.3</div>
                        <div class="metric-label">Avg PRs/min</div>
                        <div class="metric-trend trend-up">‚Üó +8% vs hour ago</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="aiDetected">234</div>
                        <div class="metric-label">AI-Generated PRs</div>
                        <div class="metric-trend">üìä 18.8% of total</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="triageQueue">12</div>
                        <div class="metric-label">Pending Triage</div>
                        <div class="metric-trend trend-down">‚Üò -3 from peak</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgProcessTime">1.2s</div>
                        <div class="metric-label">Avg Process Time</div>
                        <div class="metric-trend trend-down">‚Üò -0.3s improvement</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="systemLoad">73%</div>
                        <div class="metric-label">System Load</div>
                        <div class="metric-trend">üéØ Within normal range</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Real-time Throughput</div>
                    <canvas id="throughputChart" width="800" height="300"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">AI Detection Accuracy</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div>
                            <div style="color: #3fb950; font-size: 24px; font-weight: bold;">97.8%</div>
                            <div style="color: #8b949e;">True Positives</div>
                        </div>
                        <div>
                            <div style="color: #ffa657; font-size: 24px; font-weight: bold;">1.2%</div>
                            <div style="color: #8b949e;">False Positives</div>
                        </div>
                        <div>
                            <div style="color: #f85149; font-size: 24px; font-weight: bold;">1.0%</div>
                            <div style="color: #8b949e;">False Negatives</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Panel -->
            <div class="panel" id="logs-panel">
                <h2 style="margin-bottom: 20px; color: #58a6ff;">Real-time Processing Logs</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select id="logLevel" onchange="filterLogs()">
                        <option value="all">All Levels</option>
                        <option value="error">Errors Only</option>
                        <option value="warn">Warnings+</option>
                        <option value="info">Info+</option>
                    </select>
                    <select id="logSource" onchange="filterLogs()">
                        <option value="all">All Sources</option>
                        <option value="pipeline">Pipeline</option>
                        <option value="ai">AI Detection</option>
                        <option value="security">Security</option>
                        <option value="triage">Triage</option>
                    </select>
                    <button onclick="clearLogs()" style="background: #6f42c1; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Clear</button>
                    <button onclick="pauseLogs()" id="pauseBtn" style="background: #ffa657; color: black; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Pause</button>
                </div>
                
                <div class="log-container" id="logContainer">
                    <!-- Real-time logs will be populated here -->
                </div>
            </div>
            
            <!-- Triage Panel -->
            <div class="panel" id="triage-panel">
                <h2 style="margin-bottom: 20px; color: #58a6ff;">Human Triage Queue</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select id="triageFilter" onchange="filterTriage()">
                        <option value="all">All Items</option>
                        <option value="high">High Priority</option>
                        <option value="ai-edge">AI Edge Cases</option>
                        <option value="security">Security Flags</option>
                        <option value="quality">Quality Issues</option>
                    </select>
                    <button onclick="bulkAction('approve')" style="background: #238636; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Bulk Approve</button>
                    <button onclick="bulkAction('reject')" style="background: #da3633; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Bulk Reject</button>
                </div>
                
                <div id="triageItems">
                    <!-- Triage items will be populated here -->
                </div>
            </div>
            
            <!-- Performance Panel -->
            <div class="panel" id="performance-panel">
                <h2 style="margin-bottom: 20px; color: #58a6ff;">Performance Monitoring</h2>
                
                <div class="chart-container">
                    <div class="chart-title">Processing Performance</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div>
                            <canvas id="performanceChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 style="color: #ffa657; margin-bottom: 10px;">Current Bottlenecks</h4>
                            <div style="background: #161b22; padding: 15px; border-radius: 6px;">
                                <div style="margin-bottom: 8px;">‚Ä¢ AI Detection: <span class="highlight-score">1.2ms avg</span></div>
                                <div style="margin-bottom: 8px;">‚Ä¢ Security Scan: <span class="highlight-score">0.8ms avg</span></div>
                                <div style="margin-bottom: 8px;">‚Ä¢ Quality Analysis: <span class="highlight-result">0.5ms avg</span></div>
                                <div>‚Ä¢ Database Write: <span class="highlight-priority">2.1ms avg</span> ‚ö†Ô∏è</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">System Resources</div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 20px; color: #79c0ff;">73%</div>
                            <div style="color: #8b949e;">CPU Usage</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; color: #3fb950;">6.2GB</div>
                            <div style="color: #8b949e;">Memory Used</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; color: #ffa657;">47%</div>
                            <div style="color: #8b949e;">Disk I/O</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; color: #58a6ff;">128</div>
                            <div style="color: #8b949e;">Active Connections</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Alerts Panel -->
            <div class="panel" id="alerts-panel">
                <h2 style="margin-bottom: 20px; color: #58a6ff;">System Alerts</h2>
                
                <div id="alertsContainer">
                    <!-- Alerts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration Management
        let config = {
            // Repository Settings
            gitProvider: 'github',
            repoUrl: '',
            accessToken: '',
            webhookSecret: '',
            sshKey: '',
            
            // Grafana Settings
            grafanaUrl: 'https://aplipeline.grafana.net',
            grafanaApiKey: '',
            grafanaOrgId: 1,
            dashboardRefresh: '10s',
            grafanaAlerts: 'true',
            
            // Pipeline Settings
            qualityThreshold: 0.50,
            aiThreshold: 0.30,
            securityMode: 'strict',
            autoRejectAI: 'false',
            parallelWorkers: 8,
            batchSize: 100,
            cacheTTL: 60,
            memoryLimit: 8,
            enableProfiling: 'true'
        };
        
        let logsPaused = false;
        let selectedTriageItems = new Set();
        
        function updateConfig() {
            // Repository settings
            config.gitProvider = document.getElementById('gitProvider').value;
            config.repoUrl = document.getElementById('repoUrl').value;
            config.accessToken = document.getElementById('accessToken').value;
            config.webhookSecret = document.getElementById('webhookSecret').value;
            config.sshKey = document.getElementById('sshKey').value;
            
            // Grafana settings
            config.grafanaUrl = document.getElementById('grafanaUrl').value;
            config.grafanaApiKey = document.getElementById('grafanaApiKey').value;
            config.grafanaOrgId = parseInt(document.getElementById('grafanaOrgId').value);
            config.dashboardRefresh = document.getElementById('dashboardRefresh').value;
            config.grafanaAlerts = document.getElementById('grafanaAlerts').value;
            
            // Pipeline settings
            config.qualityThreshold = parseFloat(document.getElementById('qualityThreshold').value);
            config.aiThreshold = parseFloat(document.getElementById('aiThreshold').value);
            config.securityMode = document.getElementById('securityMode').value;
            config.autoRejectAI = document.getElementById('autoRejectAI').value;
            config.parallelWorkers = parseInt(document.getElementById('parallelWorkers').value);
            config.batchSize = parseInt(document.getElementById('batchSize').value);
            config.cacheTTL = parseInt(document.getElementById('cacheTTL').value);
            config.memoryLimit = parseInt(document.getElementById('memoryLimit').value);
            config.enableProfiling = document.getElementById('enableProfiling').value;
            
            // Update displayed values
            document.getElementById('qualityValue').textContent = config.qualityThreshold.toFixed(2);
            document.getElementById('aiValue').textContent = config.aiThreshold.toFixed(2);
            document.getElementById('workersValue').textContent = config.parallelWorkers;
            document.getElementById('batchValue').textContent = config.batchSize + ' PRs';
            document.getElementById('memoryValue').textContent = config.memoryLimit + ' GB';
            
            // Send configuration to backend
            sendConfigUpdate();
        }
        
        function saveConfiguration() {
            fetch('/api/config/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                addLog('info', 'config', 'Configuration saved successfully');
                showNotification('Configuration saved!', 'success');
            })
            .catch(error => {
                addLog('error', 'config', 'Failed to save configuration: ' + error);
                showNotification('Save failed!', 'error');
            });
        }
        
        function sendConfigUpdate() {
            fetch('/api/config/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            });
        }
        
        // Panel Management
        function showPanel(panelName) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(panelName + '-panel').classList.add('active');
            event.target.classList.add('active');
        }
        
        // Log Management
        function addLog(level, source, message) {
            if (logsPaused) return;
            
            const container = document.getElementById('logContainer');
            const timestamp = new Date().toISOString().substring(11, 23);
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-timestamp">${timestamp}</span> <span class="log-level-${level}">[${level.toUpperCase()}]</span> <span style="color: #8b949e">${source}:</span> ${message}`;
            
            container.appendChild(entry);
            
            // Keep only last 1000 entries
            while (container.children.length > 1000) {
                container.removeChild(container.firstChild);
            }
            
            // Auto-scroll to bottom
            container.scrollTop = container.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        function pauseLogs() {
            logsPaused = !logsPaused;
            document.getElementById('pauseBtn').textContent = logsPaused ? 'Resume' : 'Pause';
            document.getElementById('pauseBtn').style.background = logsPaused ? '#3fb950' : '#ffa657';
        }
        
        // Triage Management
        function addTriageItem(id, type, priority, description, data) {
            const container = document.getElementById('triageItems');
            const item = document.createElement('div');
            item.className = 'triage-item';
            item.innerHTML = `
                <div class="triage-header">
                    <div class="triage-id">#${id}</div>
                    <div class="triage-priority priority-${priority}">${priority.toUpperCase()}</div>
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #ffa657;">${type}:</strong> ${description}
                </div>
                <div style="background: #0d1117; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-size: 11px;">
                    <div style="color: #8b949e;">Repository: ${data.repo}</div>
                    <div style="color: #8b949e;">PR: #${data.pr}</div>
                    <div style="color: #8b949e;">Author: ${data.author}</div>
                    <div style="color: #8b949e;">AI Score: ${data.aiScore}</div>
                </div>
                <div class="triage-actions">
                    <button class="triage-btn btn-approve" onclick="triageAction('${id}', 'approve')">‚úÖ Approve</button>
                    <button class="triage-btn btn-reject" onclick="triageAction('${id}', 'reject')">‚ùå Reject</button>
                    <button class="triage-btn btn-escalate" onclick="triageAction('${id}', 'escalate')">‚¨ÜÔ∏è Escalate</button>
                    <input type="checkbox" onchange="selectTriageItem('${id}', this.checked)" style="margin-left: 10px;">
                </div>
            `;
            container.appendChild(item);
        }
        
        function triageAction(id, action) {
            fetch('/api/triage/action', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, action })
            })
            .then(response => response.json())
            .then(data => {
                addLog('info', 'triage', `Item #${id} ${action}ed`);
                // Remove item from UI
                event.target.closest('.triage-item').remove();
            });
        }
        
        // Real-time Updates
        function startRealTimeUpdates() {
            // Simulate real-time data updates
            setInterval(() => {
                if (!logsPaused) {
                    // Add random log entries
                    const levels = ['info', 'warn', 'error', 'success'];
                    const sources = ['pipeline', 'ai', 'security', 'triage'];
                    const messages = [
                        'PR #1234 processed successfully',
                        'AI detection confidence: 0.89',
                        'Security scan completed',
                        'Triage item escalated',
                        'Performance threshold exceeded',
                        'Cache miss for repository xyz',
                        'Worker thread started',
                        'Batch processing completed'
                    ];
                    
                    const level = levels[Math.floor(Math.random() * levels.length)];
                    const source = sources[Math.floor(Math.random() * sources.length)];
                    const message = messages[Math.floor(Math.random() * messages.length)];
                    
                    addLog(level, source, message);
                }
                
                // Update metrics
                updateMetrics();
            }, 2000);
            
            // Update throughput
            setInterval(() => {
                const throughput = Math.floor(Math.random() * 20) + 30;
                document.getElementById('throughput').textContent = throughput + ' PR/min';
                
                const queueSize = Math.floor(Math.random() * 5) + 10;
                document.getElementById('queue-size').textContent = 'Queue: ' + queueSize;
            }, 5000);
        }
        
        function updateMetrics() {
            // Simulate metric updates
            const totalPRs = parseInt(document.getElementById('totalPRs').textContent) + Math.floor(Math.random() * 3);
            document.getElementById('totalPRs').textContent = totalPRs.toLocaleString();
            
            const avgThroughput = (Math.random() * 10 + 35).toFixed(1);
            document.getElementById('avgThroughput').textContent = avgThroughput;
            
            const aiDetected = Math.floor(totalPRs * 0.188);
            document.getElementById('aiDetected').textContent = aiDetected;
        }
        
        // Repository and Grafana Functions
        function testConnection() {
            if (!config.repoUrl || !config.accessToken) {
                showNotification('Please enter repository URL and access token', 'error');
                return;
            }
            
            addLog('info', 'repo', 'Testing repository connection...');
            
            // Simulate connection test
            setTimeout(() => {
                if (config.repoUrl.includes('github.com')) {
                    addLog('success', 'repo', 'GitHub connection successful');
                    showNotification('Repository connection successful!', 'success');
                } else {
                    addLog('success', 'repo', 'Repository connection successful');
                    showNotification('Repository connection successful!', 'success');
                }
            }, 2000);
        }
        
        function setupGrafana() {
            if (!config.grafanaUrl || !config.grafanaApiKey) {
                showNotification('Please enter Grafana URL and API key', 'error');
                return;
            }
            
            addLog('info', 'grafana', 'Setting up Grafana integration...');
            
            // Simulate Grafana setup
            setTimeout(() => {
                addLog('success', 'grafana', 'Data source created: APLCICD-Pure-APL');
                addLog('info', 'grafana', 'Configuring dashboard panels...');
                
                setTimeout(() => {
                    addLog('success', 'grafana', 'Grafana integration configured successfully');
                    showNotification('Grafana setup complete!', 'success');
                }, 1500);
            }, 2000);
        }
        
        function deployDashboard() {
            if (!config.grafanaUrl || !config.grafanaApiKey) {
                showNotification('Please setup Grafana integration first', 'error');
                return;
            }
            
            addLog('info', 'grafana', 'Deploying APLCICD dashboard...');
            
            // Simulate dashboard deployment
            setTimeout(() => {
                addLog('success', 'grafana', 'Dashboard deployed to: ' + config.grafanaUrl);
                addLog('info', 'grafana', 'Dashboard UID: aplcicd-main');
                addLog('info', 'grafana', 'Panels: 12 metrics, AI algorithm comparison');
                showNotification('Dashboard deployed successfully!', 'success');
                
                // Update header status
                const statusElement = document.querySelector('.status');
                statusElement.innerHTML += '<div class="status-indicator" style="background: #ff8c00; color: black;">üìä Grafana Live</div>';
            }, 3000);
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 6px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                background: ${type === 'success' ? '#238636' : '#da3633'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateConfig();
            startRealTimeUpdates();
            
            // Add some sample triage items
            addTriageItem('PR-1001', 'AI Edge Case', 'high', 'Borderline AI detection score needs human review', {
                repo: 'myorg/backend-api',
                pr: '1001',
                author: 'dev-user-123',
                aiScore: '0.52'
            });
            
            addTriageItem('PR-1002', 'Security Flag', 'medium', 'Potential security vulnerability detected', {
                repo: 'myorg/frontend-app',
                pr: '1002', 
                author: 'contributor-xyz',
                aiScore: '0.15'
            });
            
            // Add sample alerts
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = `
                <div class="alert alert-warning">
                    <strong>Performance Warning:</strong> Database write latency elevated (2.1ms avg, threshold: 2.0ms)
                </div>
                <div class="alert alert-info">
                    <strong>System Info:</strong> Successfully processed 1,247 PRs today with 97.8% accuracy
                </div>
                <div class="alert alert-error">
                    <strong>Worker Alert:</strong> Worker thread #7 restarted due to memory limit (resolved)
                </div>
            `;
            
            addLog('info', 'system', 'APLCICD Enterprise Console initialized');
            addLog('info', 'config', 'Configuration loaded successfully');
            addLog('success', 'pipeline', 'Real-time monitoring active');
        });
    </script>
</body>
</html>